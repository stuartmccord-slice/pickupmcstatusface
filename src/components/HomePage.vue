<template>
  <div
    class="
      min-h-screen
      bg-gray-500
      py-6
      flex flex-col
      justify-start
      sm:py-12
      text-4xl
      text-white
      bg-bottom-right
      bg-cover
    "
    style="background-image: url('/background.jpg');"
  >
    <div class="flex flex-row justify-around">
      <div class="flex items-center justify-center">
        <img class="mx-auto w-64 " alt="Shop Logo" src="../assets/billys-logo.png" />
      </div>
      <div class="bg-cover text-lg font-bold flex flex-col justify-between">
        <div class="bg-black text-center w-48 py-2 rounded-t-2xl">Order</div>
        <div class="w-48 h-48 bg-cover" style="background-image: url('/slice-qr.png')"></div>
        <div class="bg-black text-center w-48 py-2 rounded-b-2xl">Here</div>
      </div>
      <div class="w-48 h-48">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 32 32"
          class="slice_logo"
        >
          <title>Slice logo</title>
          <path
            fill="currentColor"
            d="M24.6834331 10.7677136v-.5489396c0-.2144506-.0554047-.2539014-.2569979-.1965797-.2292956.065077-.4622626.1146434-.688888.1864641-.1184861.0377649-.2816965.050578-.2850341.2326587-.0076766.4390168-.005674.8776964-.0076766 1.3167132 0 .081262.0433893.1193641.1174848.1099228.0827733-.0107899.165213-.028998.2459838-.0499036.2202839-.0573217.4405679-.1132946.6581817-.1783716.1695519-.050578.2166126-.1254334.2169463-.3095372v-.5624271m-.7125852 4.0715269c.1902452-.0485549.3838281-.0927263.5640605-.1682561.0667527-.0276493.1251613-.1342002.142517-.2147878.024031-.1136318.005674-.2367049.0060077-.3557317.0010014-.2046722.0433893-.289306.2289619-.3462905.2943795-.0907032.5940991-.1638727.8931513-.2360306.1118108-.0269749.1852388.0387765.1842375.1544314-.0036714.374277.0193583.753949-.0340439 1.1214823-.0724267.4953269-.3738152.8362225-.8287349 1.0223494-.7860133.3213387-1.5720265.6406544-2.3583735.9603072-.509657.2070325-1.020649.4113675-1.5299722.6194115-.5240088.2147878-1.0453475.4363193-1.5703577.6487468-.7219306.2920035-1.4475326.5752402-2.1694632.8675809-.5169998.20973-1.0289931.4315987-1.5459929.642003-.7165904.2916663-1.4368522.5755774-2.1537764.8665693-.5220062.2120903-1.0400073.433959-1.5620135.645375-.7222644.2923407-1.4475326.5755773-2.1694632.8689295-.56072285.2276009-1.11610544.4676777-1.67649449.6956158-.67754006.2751442-1.35741647.5428702-2.03595782.8139682-.02002581.0080924-.0357127.0306839-.05573851.0350674-.21527751.0475433-.29905217.0212427-.29838464-.1982657.00400516-1.0661837.00166882-2.1327045.00333764-3.1992254 0-.2235546.06475013-.3044794.26667709-.3604524.4756131-.1308283.95055867-.2650286 1.42617177-.3961941a40.0343935 40.0343935 0 01.63448456-.168256c.14885855-.0384393.22295406-.1315028.2236216-.2913291.00033376-.2744699-.00333764-.5492769.00133505-.8237467.00200258-.1129575-.04505809-.162861-.14885856-.1847782-.54770603-.1159921-1.09908346-.2184968-1.64044798-.3601151-.37581779-.0984585-.60377831-.3877645-.7092476-.7670993-.03838281-.1382464-.05073206-.2879572-.05273464-.4329474-.00634151-.4895948.00667527-.9795268-.00500646-1.4687844-.01335054-.5432074.35712703-1.1093435.89682273-1.2924358.3207468-.1089112.65484414-.1756742.98226621-.2643542.32274938-.0873313.6441637-.1793832.96691308-.2670517.57173701-.155443.98460255.1072253 1.01430751.7276484.01635442.3378609.00300388.6770705.00300388 1.0159429 0 .3243735-.05273465.3938338-.35712703.475433-.24164483.0640654-.48328966.130154-.72526826.1948938-.11915359.0316955-.2226203-.0445087-.22462288-.1723023-.00333764-.2107416-.00066753-.4214832-.00166882-.6318875-.00066753-.119364-.0750968-.1830923-.18490502-.1551058-.22695923.0576589-.45325094.1186896-.67954265.1787088-.39450854.135549-.40652403.1520711-.40652403.5246622 0 .2380537-.00100129.4757701.00100129.7138238.00133506.169942.05507099.2265893.20960353.2589593.44451419.0918391.88810816.1881668 1.33071538.2889688.16921813.0387764.34678035.0748554.49730773.1571289.381158.2077068.52400881.5765888.53735936.9957116.01535312.466329.00667526.9336695.00166881 1.4003355-.00100129.1072254-.0283699.2137763-.04572561.3371865.0981265-.0202311.18256868-.0330442.26367318-.0563101.2756025-.0767769.5499902-.1579365.823061-.2434487.0360465-.0118015.0624138-.0681116.0841085-.1092483.0113479-.0212428.0023363-.0539499.0023363-.0809249 0-2.0322229.0006675-4.0644459-.0013351-6.0963316 0-.2346818.0337102-.3267338.2836991-.4026007.2443149-.0745182.492635-.1365605.7402876-.19894.1959192-.0499036.2586667.0087668.258333.233333v5.7078929c.1725557-.045183 1.0239867-.2849226 1.2943352-.3628127.1435183-.0411367.2553291.0421483.2630057.1989401.0050064.0947494.0010012.1901732.0010012.3068397 0 0 .2435362-.0811496.7306085-.2434487.0133506-.9679939.0136843-2.6893994.0140181-3.8931552 0-.2434486.0700904-.3338146.2977171-.3961941.2369721-.0647398.4732768-.1342002.7099151-.2016375.2035958-.0579961.3043924.0202312.3047262.2394024v3.9248507c.2002581-.0505779.5740733-.1436414 1.0793914-.2896432.1191536-.0229287.1471897-.0745182.1468559-.1918591-.0033376-1.7617994 0-3.523936-.0040051-5.2860726-.0006676-.3189784.0634151-.6109819.2423123-.8743246.1902453-.2795276.4338927-.4717238.7623161-.5543345.3371012-.084971.6685284-.1928707 1.0036271-.2859342.2635923-.0734975.5284173-.1424062.7943573-.2066953.1189818-.02698068.239635-.04579373.3611322-.05631014.4025188-.04046238.6842153.33920964.6935606.66223424.0166882.5624271.0106805 1.1255285.0073429 1.6882928-.0010014.1638726-.1108095.2596336-.317743.3125718-.2296293.0593449-.4595924.1180153-.6878867.1830923-.2109386.0603564-.289373.0070809-.2917093-.2198456-.0033377-.2700864.0023363-.5401727-.0003339-.8102591-.0010012-.0987957-.0153531-.1975913-.026701-.3348262-.1862401.0370905-.3524543.0644026-.5159985.1031791-.1501936.0357417-.2970496.0883428-.4472432.124759-.1935829.0472061-.2666771.133863-.2666771.3395468v4.1878562c0 .1810691.0544035.2211943.2262917.1743254.2663433-.0724951.5333542-.1439787.8003651-.2141134.122825-.0320328.2079347-.0960982.2156112-.2373793.005674-.1092485.0150194-.2184969.0160207-.3280825.0030038-.2913291.0587424-.3648358.333096-.4359821.2319657-.0596821.4632639-.1223987.694562-.1844411.1932491-.0519266.2690135.0023604.2713498.2093929.0040052.3156065.0013351.6315503.0013351.947494v.175337c.27669-.074181.0233451 0 1.0463488-.2882945.0924525-.0101155.1081394-.0617051.1094744-.1362233.0010014-.0458574.0016689-.0917147.0016689-.1375721 0-1.7709034-.0030039-3.5421441.0016688-5.3133847.0016688-.58704166.2903743-1.00683884.79903-1.23612566.295047-.13285147.6228028-.18882443.9365406-.27581854.3985137-.1099228.7976949-.21815966 1.1972099-.32369903.4806196-.12711931.9111746.18916162.9191849.69797603.0123493.7866561.0203596 1.5746609-.0013351 2.3609798-.0153531.5597296-.4582573 1.1090064-1.0046283 1.2324166-.3985137.0900288-.7883496.2195084-1.1821906.3304428-.0383828.0107899-.0801032.0094412-.1174847.0219171-.1134797.0381021-.2322995.0765413-.2336345.2319843-.0026702.4710495-.0030039.9420991-.0026702 1.4128114 0 .0313583.0110142.0623795.0243648.1321771.1695519-.0367533.3364337-.0674373.5006453-.1095856zm-8.1285545-2.9072441c-.003488.1291032-.0691259.2098261-.2137195.2472473-.2466971.0638834-.4943454.1256284-.7438962.1790873-.2213298.048113-.2885531-.0042767-.2885531-.2050148 0-.1558327.0053905-.3116653-.0012684-.4672307-.013952-.3255646.1036889-.3357218.3748019-.4028127.2124512-.0523897.4261708-.0997008.6386219-.1515559.1166896-.0286005.2270374.0366193.2324279.1483484.0053906.1119964.0012684.2245273.0012684.336791.0009513.1050467.003171.2100934.0003171.3151401z"
          ></path>
        </svg>
      </div>
    </div>
    <OrderTable :orders="orders" :page="currentPage" :perPage="perPage" :eta="shop.eta" />
  </div>
</template>

<script lang="ts">
import {defineComponent} from 'vue';
import OrderTable from './OrderTable.vue';

export default defineComponent({
  name: 'HomePage',
  components: {
    OrderTable,
  },
  data: function () {
    return {
      shop: {
      },
      orders: [],
      currentPage: 0,
      perPage: 4,
    };
  },
  methods: {
    getOrders(shop_id: string) {
      const url =
        'http://localhost:3005/api/v2/shops/' + shop_id + '/delivery_orders'
      fetch(url)
        .then(response => {
          return response.json()
        })
        .then(body => {
          this.orders = body.orders
          this.shop = body.shop
        });
    },
    pageData() {
      this.polling = setInterval(() => {
        this.nextPage()
      }, 10 * 1000)
    },
    nextPage() {
      let numOrders = this.orders.length
      if (this.currentPage * this.perPage + this.perPage >= numOrders) {
        this.getOrders('7')
        this.currentPage = 0
      } else {
        this.currentPage++
      }
    },
  },
  created() {
    this.getOrders('7')
    this.pageData()
  },
  beforeUnmount() {
    clearInterval(this.polling)
  }
});
</script>
